<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Building Event Driven Experiences with MongoDB Realm and AWS &#183; /misczak</title><meta name=title content="Building Event Driven Experiences with MongoDB Realm and AWS &#183; /misczak"><meta name=description content="Using MongoDB Realm triggers and functions to connect to AWS services."><meta name=keywords content="MongoDB,AWS,NodeJS,"><link rel=canonical href=https://www.misczak.com/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/><meta name=author content="John Misczak"><link href=https://bsky.app/profile/misczak.com rel=me><link href=https://github.com/misczak rel=me><link href=https://www.linkedin.com/in/johnmisczak/ rel=me><meta property="og:url" content="https://www.misczak.com/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/"><meta property="og:site_name" content="/misczak"><meta property="og:title" content="Building Event Driven Experiences with MongoDB Realm and AWS"><meta property="og:description" content="Using MongoDB Realm triggers and functions to connect to AWS services."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-20T00:00:00+00:00"><meta property="article:tag" content="MongoDB"><meta property="article:tag" content="AWS"><meta property="article:tag" content="NodeJS"><meta property="og:image" content="https://www.misczak.com/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.misczak.com/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/featured.png"><meta name=twitter:title content="Building Event Driven Experiences with MongoDB Realm and AWS"><meta name=twitter:description content="Using MongoDB Realm triggers and functions to connect to AWS services."><link type=text/css rel=stylesheet href=/css/main.bundle.min.f41394a5c0e10c1cf8a65888f77e21ec279d86842cd26f2d94fc9956dfaa3240ba32a773ef895535ec8fa317a1eeeaeeecb64add401d2082d37bf1031716a0f9.css integrity="sha512-9BOUpcDhDBz4pliI934h7CedhoQs0m8tlPyZVt+qMkC6Mqdz74lVNeyPoxeh7uru7LZK3UAdIILTe/EDFxag+Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.f9fe268fcd89dff326e0b5bf1183a8dd1c1ec5059292635b1eed4e4ed7b35aa272234cecb245d91be3e1b7fd9403e6e5cfcdd7d5a4fcb2c8ba11deb4b81dadd2.js integrity="sha512-+f4mj82J3/Mm4LW/EYOo3RwexQWSkmNbHu1OTtezWqJyI0zsskXZG+Pht/2UA+blz83X1aT8ssi6Ed60uB2t0g==" data-copy=Copy data-copied=Copied></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Building Event Driven Experiences with MongoDB Realm and AWS","headline":"Building Event Driven Experiences with MongoDB Realm and AWS","description":"Using MongoDB Realm triggers and functions to connect to AWS services.","inLanguage":"en","url":"https://www.misczak.com/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/","author":{"@type":"Person","name":"John Misczak"},"copyrightYear":"2022","dateCreated":"2022-03-20T00:00:00\u002b00:00","datePublished":"2022-03-20T00:00:00\u002b00:00","dateModified":"2022-03-20T00:00:00\u002b00:00","keywords":["MongoDB","AWS","NodeJS"],"mainEntityOfPage":"true","wordCount":"1896"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium">/misczak</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Posts><p class="text-base font-medium">Blog</p></a><a href=/about/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=About title><p class="text-base font-medium">About</p></a><a href class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" title></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Posts><p class="text-bg font-bg">Blog</p></a></li><li class=mt-1><a href=/about/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=About title><p class="text-bg font-bg">About</p></a></li><li class=mt-1><a href class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" title></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>/misczak</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/>Building Event Driven Experiences with MongoDB Realm and AWS</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Building Event Driven Experiences with MongoDB Realm and AWS</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-03-20T00:00:00+00:00>20 March 2022</time><span class="px-2 text-primary-500">&#183;</span><span>1896 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt="John Misczak" src=/author_hu_924c9052936f489a.jpg data-zoom-src=/author_hu_f61222ad8a934e63.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">John Misczak</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Security Engineer in Philadelphia</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://bsky.app/profile/misczak.com target=_blank aria-label=Bluesky title=Bluesky rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/misczak target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/johnmisczak/ target=_blank aria-label=Linkedin title=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#pre-requisites>Pre-requisites</a></li><li><a href=#emulating-an-application-environment>Emulating an application environment</a><ul><li><a href=#set-up-mongodb-cluster>Set up MongoDB Cluster</a></li><li><a href=#set-up-the-s3-bucket>Set up the S3 Bucket</a></li><li><a href=#set-up-parameters-in-ssm>Set up parameters in SSM</a></li></ul></li><li><a href=#configuring-mongodb-atlas-and-realm>Configuring MongoDB Atlas and Realm</a><ul><li><a href=#load-data-into-cluster>Load Data Into Cluster</a></li><li><a href=#set-up-realm-app>Set up Realm App</a></li><li><a href=#set-up-realm-values-and-secrets>Set up Realm Values and Secrets</a></li><li><a href=#create-realm-functions>Create Realm Functions</a></li></ul></li><li><a href=#deploying-and-testing>Deploying and Testing</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#pre-requisites>Pre-requisites</a></li><li><a href=#emulating-an-application-environment>Emulating an application environment</a><ul><li><a href=#set-up-mongodb-cluster>Set up MongoDB Cluster</a></li><li><a href=#set-up-the-s3-bucket>Set up the S3 Bucket</a></li><li><a href=#set-up-parameters-in-ssm>Set up parameters in SSM</a></li></ul></li><li><a href=#configuring-mongodb-atlas-and-realm>Configuring MongoDB Atlas and Realm</a><ul><li><a href=#load-data-into-cluster>Load Data Into Cluster</a></li><li><a href=#set-up-realm-app>Set up Realm App</a></li><li><a href=#set-up-realm-values-and-secrets>Set up Realm Values and Secrets</a></li><li><a href=#create-realm-functions>Create Realm Functions</a></li></ul></li><li><a href=#deploying-and-testing>Deploying and Testing</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>Disclaimer: I am a MongoDB employee.</p><p>Most developers by now are familiar with MongoDB, a NoSQL database that stores data as documents instead of rows. MongoDB&rsquo;s fully managed service product, MongoDB Atlas, comes with MongoDB Realm, which is a set of services that help facilitate mobile and web development by providing a scalable, serverless backend for your application. Realm offers a lot of services (more than we can cover in just this post), but today I wanted to focus on how to use two of them in tandem to help connect a MongoDB Atlas database into a distributed, event driven architecture that can be built on AWS.</p><h2 class="relative group">Pre-requisites<div id=pre-requisites class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#pre-requisites aria-label=Anchor>#</a></span></h2><p>Before we get started, there are a couple of things you should have setup already. These include:</p><ol><li><p>An AWS account with an IAM user created, and an access key created for that IAM user. The user should have permissions to create, edit, and retrieve parameters from AWS Systems Manager and put objects, list buckets, and get objects from S3.</p></li><li><p>A MongoDB Atlas account. It is <a href=https://www.mongodb.com/cloud/atlas/register target=_blank>free to sign up</a>, and there is a free tier that you can use to follow along with this post. The Community version of MongoDB does not include MongoDB Realm, so this post does not apply to it.</p></li></ol><h2 class="relative group">Emulating an application environment<div id=emulating-an-application-environment class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#emulating-an-application-environment aria-label=Anchor>#</a></span></h2><p>We&rsquo;re going to have to setup a few things to make this look and feel like an environment a real application is using. Most modern applications are not just writing data to a database and reading it back; rather, they are consuming events from/publishing events to a message queue or stream, interacting with cloud storage, and relying on slight changes to data to kick off workflows. To keep things simple, our goal will be to monitor our database for new documents that are inserted and to upload a copy of them to S3 at the exact moment they are written to the database. In our theoretical application, we are using the copy of the document to do some additional processing or analysis with an AWS service that is reading from S3.</p><h3 class="relative group">Set up MongoDB Cluster<div id=set-up-mongodb-cluster class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#set-up-mongodb-cluster aria-label=Anchor>#</a></span></h3><p>Log into your MongoDB Atlas account. Create a project to act as the container for your cluster, then create a cluster. If you want to use the free tier, choose the <strong>Shared</strong> category at the top of the Create Cluster page. Use a recommended, free-tier region such as <code>us-east-1</code> or <code>us-east-2</code> and then scroll down select the <strong>M0 Sandbox</strong> Cluster Tier. Change the name of the cluster from <strong>Cluster0</strong> to <strong>Sandbox</strong> and click on <strong>Create Cluster</strong>.</p><h3 class="relative group">Set up the S3 Bucket<div id=set-up-the-s3-bucket class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#set-up-the-s3-bucket aria-label=Anchor>#</a></span></h3><p>While the MongoDB cluster is creating, head over to the AWS console and login as your IAM user. Go to Amazon S3 in the AWS console and choose <strong>Create bucket</strong>. Give it a name like <code>{yourname}-event-bucket</code> and select the same region that you created your MongoDB Atlas cluster in. Leave the other options as the default selections and click <strong>Create bucket</strong> at the bottom of the page.</p><h3 class="relative group">Set up parameters in SSM<div id=set-up-parameters-in-ssm class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#set-up-parameters-in-ssm aria-label=Anchor>#</a></span></h3><p>In the AWS console, search for AWS Systems Manager (SSM) and navigate to the service page. Once there, select <strong>Parameter Store</strong> on the left hand navigation, under Application Management. Select <strong>Create Parameter</strong>.</p><p>On the Create parameter page, enter <code>event-target-bucket</code> as the name for the parameter. Leave the Tier as Standard, the Type as String, and the Data type as text. Under value, enter the name of the S3 bucket you created in the previous step.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Setting the SSM Parameter for S3 bucket name" width=896 height=829 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/ssm_hu_c34440ce29e10279.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/ssm_hu_c34440ce29e10279.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/ssm.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/ssm.png></figure><h2 class="relative group">Configuring MongoDB Atlas and Realm<div id=configuring-mongodb-atlas-and-realm class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#configuring-mongodb-atlas-and-realm aria-label=Anchor>#</a></span></h2><h3 class="relative group">Load Data Into Cluster<div id=load-data-into-cluster class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#load-data-into-cluster aria-label=Anchor>#</a></span></h3><p>Return to the MongoDB Atlas console. When your sandbox is finished provisioning, click the <strong>&mldr;</strong> button and choose <strong>Load Sample Dataset</strong>. This will give us a few databases and collections of data to use for our testing purposes.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Loading sample data into MongoDB Atlas" width=735 height=391 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/atlassandbox.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/atlassandbox.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/atlassandbox.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/atlassandbox.png></figure><h3 class="relative group">Set up Realm App<div id=set-up-realm-app class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#set-up-realm-app aria-label=Anchor>#</a></span></h3><p>While that data is being loaded, click on the <strong>Realm</strong> tab near the top of the screen. We want to select <strong>Create a New App</strong> and name it <code>AWS-Event-App</code>. Under &ldquo;Link your Database&rdquo;, select <strong>Use an existing MongoDB Atlas Data Source</strong> and choose the Sandbox cluster you created. Then click <strong>Create Realm Application</strong>.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Creating a MongoDB Realm App" width=920 height=655 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/createrealmapp_hu_eaf73ec346c9219e.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/createrealmapp_hu_eaf73ec346c9219e.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/createrealmapp.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/createrealmapp.png></figure><h3 class="relative group">Set up Realm Values and Secrets<div id=set-up-realm-values-and-secrets class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#set-up-realm-values-and-secrets aria-label=Anchor>#</a></span></h3><p>In order to hook into our AWS account and use the bucket and the parameter we just set up, we have to authenticate to the account from MongoDB Realm. Since we&rsquo;ll be using our AWS IAM user&rsquo;s access key and secret key, we don&rsquo;t want to hardcode it into any code we end up writing or reading from source control. Therefore, we will use Realm&rsquo;s Values feature to securely store these values.</p><p>Realm&rsquo;s Values feature allows you to store two types of values - regular values and secrets. Secrets cannot be directly accessed by the Realm API; instead, they must be mapped to their own regular value in order to be able to be retrieved. This prevents you from inadvertantly exposing a secret you did not intend to.</p><p>Click on <strong>Values</strong> in the left hand navigation of your Realm app. Click on <strong>Create New Value</strong>. For the value&rsquo;s name, enter <code>AccessKeyID</code>. Choose <code>Value</code> as the type, then for Content select <code>Custom Content</code> and paste in your Access Key wrapped in double quotations to mark it as a string. Then click on <strong>Save Draft</strong>.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Setting up the Access Key ID as a Realm Value" width=1219 height=658 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue1_hu_a0d0923c3ce82c25.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue1_hu_a0d0923c3ce82c25.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue1.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue1.png></figure><p>Click on <strong>Create New Value</strong> again. Enter <code>SecretAccessKeySecret</code> as the value name, and this time select <code>Secret</code> under Type. For the value of secret, paste in your AWS IAM user&rsquo;s Secret Access Key, then click <strong>Save Draft</strong>.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Setting up the Secret Key as a Realm Secret" width=1224 height=465 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmsecret_hu_feb3232184e9dbc2.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmsecret_hu_feb3232184e9dbc2.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmsecret.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmsecret.png></figure><p>We&rsquo;ve entered the Secret Access Key, but we cannot directly access it via the Realm API since it is a secret. We now have to create a value and map it to that secret. Click on <strong>Create New Value</strong> a third time. Enter <code>SecretAccessKey</code> and select <code>Value</code> as the type. Under Add Content, choose <code>Link to Secret</code> and select the <code>SecretAccessKeySecret</code> you just created. Click <strong>Save Draft</strong>.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Linking a Realm Value to the Realm Secret" width=1233 height=522 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue2_hu_5b2bfc2abd79a4d7.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue2_hu_5b2bfc2abd79a4d7.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue2.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmvalue2.png></figure><p>We have one more value to set up before we&rsquo;re done. Click on <strong>Create New Value</strong> again, and this time enter <code>Region</code> as the value name. Leave Type as <code>Value</code> and Add Content as <code>Custom Content</code>. In the content field, enter the AWS region where you set up your S3 bucket and SSM parameter, again wrapped in double quotations. Then click <strong>Save Draft</strong>.</p><p>You may ask why we bothered with SSM at all to store the parameter of the S3 bucket name. It is true that we could also store the bucket name here in Realm&rsquo;s values; however, for the scope of the post we will assume the application environment has already been using SSM for parameters such as these, and therefore it will be less work for us to leave it that way.</p><h3 class="relative group">Create Realm Functions<div id=create-realm-functions class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#create-realm-functions aria-label=Anchor>#</a></span></h3><p>Now we are ready to start writing some code. First, let&rsquo;s bring in the AWS SDK which we will use in our code to make calls to the specific AWS services we will use. Select <strong>Functions</strong> in the left hand navigation then click the <strong>Dependencies</strong> tab at the top of the page. Select <strong>Add Dependency</strong>. On the modal that appears, enter <code>aws-sdk</code> as the package name. You can leave the version blank, but if you run into issues, you may want to come back and change the version to 2.737.0, which is what I used to write this post. When you&rsquo;re done, click <strong>Add</strong>.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Adding the aws-sdk library as a dependency" width=592 height=411 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmnpmlibrary.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmnpmlibrary.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmnpmlibrary.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmnpmlibrary.png></figure><p>The <code>aws-sdk</code> node library should be added as a dependency. Now click <strong>Create New Function</strong> button in the upper right. In the Add Function page, enter <code>MoveDocToQueue</code> as the function and for now choose <code>System</code> under Authentication. Click on the <strong>Function Editor</strong> tab at the top, and paste this code in over what is currently there.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>exports</span> <span class=o>=</span> <span class=kr>async</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>AWS</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;aws-sdk&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>accessKeyId</span><span class=o>:</span> <span class=nx>context</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;AccessKeyID&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>secretAccessKey</span><span class=o>:</span> <span class=nx>context</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;SecretAccessKey&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>region</span><span class=o>:</span> <span class=nx>context</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;Region&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>SSMparams</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Name</span><span class=o>:</span> <span class=s1>&#39;event-target-bucket&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>WithDecryption</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>doc</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>fullDocument</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>SSM</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AWS</span><span class=p>.</span><span class=nx>SSM</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ssmPromise</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>SSM</span><span class=p>.</span><span class=nx>getParameter</span><span class=p>(</span><span class=nx>SSMparams</span><span class=p>).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>bucketName</span> <span class=o>=</span> <span class=nx>ssmPromise</span><span class=p>.</span><span class=nx>Parameter</span><span class=p>.</span><span class=nx>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>S3params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>bucketName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Key</span><span class=o>:</span> <span class=s2>&#34;queue-&#34;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>fullDocument</span><span class=p>.</span><span class=nx>_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Body</span><span class=o>:</span> <span class=nx>doc</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>S3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AWS</span><span class=p>.</span><span class=nx>S3</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>s3Promise</span> <span class=o>=</span> <span class=nx>S3</span><span class=p>.</span><span class=nx>putObject</span><span class=p>(</span><span class=nx>S3params</span><span class=p>).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>s3Promise</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Put Object Success&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Configuring the Realm Function" width=1223 height=542 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction1_hu_75d53b0f85b9fcd1.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction1_hu_75d53b0f85b9fcd1.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction1.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction1.png></figure><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Editing the code of the Realm Function" width=1237 height=750 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction2_hu_7227eb9e03263aa5.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction2_hu_7227eb9e03263aa5.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction2.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmfunction2.png></figure><p>Normally with Realm functions, you can click on <strong>Run</strong> near the bottom right to test out the function. However, since this function will require a change event in the database to run, we will need to map it to a trigger first and modify some data to test it out. For now, click on <strong>Save Draft</strong>.</p><p>We now have the actual code we want to run to move documents to our S3 bucket. But how do we get it to run whenever we insert data? The answer is a Realm Trigger. Select <strong>Triggers</strong> on the left hand navigation, then add a new trigger.</p><p>On the Add Trigger page, enter <code>moveDocToQueueTrigger</code> as the name, then select your Sandbox cluster under Trigger Source Details. For database, select <code>sample_mflix</code> and for collection select <code>movies</code>. Under Operation type, ensure <code>Insert</code> is checked as we want this trigger to fire on every new document inserted into the sample_mflix.movies collection. Keep scrolling down and ensure that Full Document is turned to <code>ON</code>. Under Select an Event Type, choose Function and select the <code>MoveDocToQueue</code> function that we just created. Then click <strong>Save</strong>.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Configuring the Realm Trigger Part 1" width=1196 height=856 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger1_hu_15c1e60eedf01092.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger1_hu_15c1e60eedf01092.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger1.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger1.png></figure><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Configuring the Realm Trigger Part 2" width=1186 height=561 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger2_hu_44adced9fba0202.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger2_hu_44adced9fba0202.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger2.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/realmtrigger2.png></figure><h2 class="relative group">Deploying and Testing<div id=deploying-and-testing class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#deploying-and-testing aria-label=Anchor>#</a></span></h2><p>We are now ready to try our first test! On the blue banner at the top of the page, you can now choose to Deploy the changes to your Realm app. The values, secrets, function, and trigger should now be ready to go. Open up a connection to your MongoDB cluster and insert a new document into the <code>sample_mflix.movies</code> collection. You can do this via the <a href=https://www.mongodb.com/try/download/shell target=_blank>mongo shell</a>, a MongoDB driver, <a href=https://www.mongodb.com/products/compass target=_blank>MongoDB Compass</a>, or just by using the Data Explorer built into Atlas to duplicate an existing document in that collection. Keep in mind that if you are using the shell, a driver, or Compass, you will need to <a href=https://docs.atlas.mongodb.com/security/add-ip-address-to-list/ target=_blank>add your current IP address to the IP Access list</a> in your Atlas project.</p><p>After you have inserted a new document, return to MongoDB Realm and select Logs in the left hand navigation. You should an entry in the History showing when your trigger was invoked. Expanding the entry will show you the logs from that particular function - if you set up your values and secrets correctly, you should see the log message &ldquo;Put Object Success&rdquo;, meaning that our attempt to put the document into the S3 bucket appears to be successful. (If you do not see this output, double check your values and secrets, your IAM user permissions, and your S3 and SSM configuration.)</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Seeing the log output showing a successful upload" width=957 height=491 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/logoutput_hu_22431595cb2d6e7d.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/logoutput_hu_22431595cb2d6e7d.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/logoutput.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/logoutput.png></figure><p>Let&rsquo;s double check that this actually sent the document to S3 by going back to our AWS console and navigating to the S3 service page. Find the bucket that you created at the beginning of this process and open it up. You should see an object in there starting with <code>queue-</code> and then the _id value of the document you inserted. The object is named this way because we set this as the Key value when setting up the S3 parameters in our Realm function. If you see the document, then your setup is successful!</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="Seeing the document show up in S3" width=1199 height=265 src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/s3result_hu_d3ec65d331174d67.png srcset="/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/s3result_hu_d3ec65d331174d67.png 800w, /posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/s3result.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/building-event-driven-experiences-with-mongodb-realm-and-aws/images/s3result.png></figure><p>You can continue experimenting by bringing in other AWS services as well, such as sending the document to a Kinesis data stream instead of just an S3 bucket.</p></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/2022-03-20/index.md data-oid-likes=likes_posts/2022-03-20/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/tracking-temperature-and-humidity-at-home-with-time-series-data/><span class=leading-6>Tracking Temperature and Humidity at Home with Time Series Data&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2022-05-30T00:00:00+00:00>30 May 2022</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 overflow-x-auto py-2"><ul class="flex list-none flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 me-4"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href title></a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
John Misczak</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://www.misczak.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>