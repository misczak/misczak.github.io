<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Automatically tagging resources in AWS with Owner Information &#183; /misczak</title><meta name=title content="Automatically tagging resources in AWS with Owner Information &#183; /misczak"><meta name=description content="A detailed write-up on extending an AWS Cloud Operations & Migrations Blog post example for automatically tagging EC2 instances in AWS."><meta name=keywords content="AWS,"><link rel=canonical href=https://misczak.github.io/posts/automatically-tagging-resources-in-aws-with-owner-information/><meta name=author content="John Misczak"><link href=https://bsky.app/profile/misczak.com rel=me><link href=https://github.com/misczak rel=me><link href=https://www.linkedin.com/in/johnmisczak/ rel=me><meta property="og:url" content="https://misczak.github.io/posts/automatically-tagging-resources-in-aws-with-owner-information/"><meta property="og:site_name" content="/misczak"><meta property="og:title" content="Automatically tagging resources in AWS with Owner Information"><meta property="og:description" content="A detailed write-up on extending an AWS Cloud Operations & Migrations Blog post example for automatically tagging EC2 instances in AWS."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-31T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-31T00:00:00+00:00"><meta property="article:tag" content="AWS"><meta property="og:image" content="https://misczak.github.io/posts/automatically-tagging-resources-in-aws-with-owner-information/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://misczak.github.io/posts/automatically-tagging-resources-in-aws-with-owner-information/featured.png"><meta name=twitter:title content="Automatically tagging resources in AWS with Owner Information"><meta name=twitter:description content="A detailed write-up on extending an AWS Cloud Operations & Migrations Blog post example for automatically tagging EC2 instances in AWS."><link type=text/css rel=stylesheet href=/css/main.bundle.min.f41394a5c0e10c1cf8a65888f77e21ec279d86842cd26f2d94fc9956dfaa3240ba32a773ef895535ec8fa317a1eeeaeeecb64add401d2082d37bf1031716a0f9.css integrity="sha512-9BOUpcDhDBz4pliI934h7CedhoQs0m8tlPyZVt+qMkC6Mqdz74lVNeyPoxeh7uru7LZK3UAdIILTe/EDFxag+Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.174bcf70e6e1263b171d57722e12e947c094a38b89ba10267b8744db900c25af6426a478c44554553ac180127863a0014c61409cb86b8052ec370dd7cc92d593.js integrity="sha512-F0vPcObhJjsXHVdyLhLpR8CUo4uJuhAme4dE25AMJa9kJqR4xEVUVTrBgBJ4Y6ABTGFAnLhrgFLsNw3XzJLVkw==" data-copy=Copy data-copied=Copied></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Automatically tagging resources in AWS with Owner Information","headline":"Automatically tagging resources in AWS with Owner Information","description":"A detailed write-up on extending an AWS Cloud Operations \u0026 Migrations Blog post example for automatically tagging EC2 instances in AWS.","inLanguage":"en","url":"https://misczak.github.io/posts/automatically-tagging-resources-in-aws-with-owner-information/","author":{"@type":"Person","name":"John Misczak"},"copyrightYear":"2023","dateCreated":"2023-07-31T00:00:00\u002b00:00","datePublished":"2023-07-31T00:00:00\u002b00:00","dateModified":"2023-07-31T00:00:00\u002b00:00","keywords":["AWS"],"mainEntityOfPage":"true","wordCount":"2154"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium">/misczak</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Posts><p class="text-base font-medium">Blog</p></a><a href=/about/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=About title><p class="text-base font-medium">About</p></a><a href class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" title></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Posts><p class="text-bg font-bg">Blog</p></a></li><li class=mt-1><a href=/about/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=About title><p class="text-bg font-bg">About</p></a></li><li class=mt-1><a href class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" title></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>/misczak</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/automatically-tagging-resources-in-aws-with-owner-information/>Automatically tagging resources in AWS with Owner Information</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Automatically tagging resources in AWS with Owner Information</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-07-31T00:00:00+00:00>31 July 2023</time><span class="px-2 text-primary-500">&#183;</span><span>2154 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">11 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt="John Misczak" src=/author_hu_16dc406033739085.jpg data-zoom-src=/author_hu_e6186a32d99662da.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">John Misczak</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Security Engineer in Philadelphia</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://bsky.app/profile/misczak.com target=_blank aria-label=Bluesky title=Bluesky rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/misczak target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/johnmisczak/ target=_blank aria-label=Linkedin title=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#researching-previous-work>Researching Previous Work</a></li><li><a href=#the-auto-tagging-solution-explained>The Auto Tagging Solution, Explained</a></li><li><a href=#modifying-the-aws-example>Modifying the AWS Example</a></li><li><a href=#applying-the-service-control-policy>Applying the Service Control Policy</a></li><li><a href=#results-and-additional-considerations>Results and Additional Considerations</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#researching-previous-work>Researching Previous Work</a></li><li><a href=#the-auto-tagging-solution-explained>The Auto Tagging Solution, Explained</a></li><li><a href=#modifying-the-aws-example>Modifying the AWS Example</a></li><li><a href=#applying-the-service-control-policy>Applying the Service Control Policy</a></li><li><a href=#results-and-additional-considerations>Results and Additional Considerations</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h2 class="relative group">Background<div id=background class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#background aria-label=Anchor>#</a></span></h2><p>One of AWS&rsquo; best practices for building and managing infrastructure in the cloud is to use consistent, accurate tags for the purposes of cost management, correct owner attribution (during operations and security incidents), and even attribute-based access control. This type of tag compliance can be easier said than done, however, especially when dealing with an organization that has a number of accounts owned by different teams with very different tooling and working styles.</p><p>My team has dealt with a number of security incidents over the last year where finding the correct owner of an EC2 instance took too much time, in our eyes, at the beginning of the incident. No tags were added to the instance besides <code>Name</code>, and while CloudTrail would capture the the events that created the resource (and the principal involved), some resources predated our currently retained CloudTrail logs - meaning we did not have a record of the user that created them.</p><p>While it is possible to require tags to be added to resources at the time of creation (otherwise blocking the creation of the resource), my team preferred not to pursue this approach for a few reasons. Implementing that type of compliance check would take a very long time to incorporate into the various workflows across the dozens of accounts for which we have oversight. Moreover, restricting resource creation until somebody enters the correct tag information can make the security team look like blockers instead of team players, which is something we are always looking to avoid.</p><p>For these reasons, I wanted to see what could be done to leverage information AWS has about our resources in order to attach tags about the owner to the instance&rsquo;s metadata itself without, so it would live alongside the instance for the duration of its lifetime. The preferred approach would not require any additional work on behalf of the individual or team creating the resources in the first place, and not interfere with their existing workflows.</p><h2 class="relative group">Researching Previous Work<div id=researching-previous-work class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#researching-previous-work aria-label=Anchor>#</a></span></h2><p>A lot of times when trying to work on projects such as this one, I end up with the thought process that somebody, somewhere, has to have solved this particular problem before. So I began my research process across the Internet, Reddit, and even the Cloud Security Slack.</p><p>What became immediately apparent is that AWS already has this information available to you; however, it&rsquo;s just not in a format (or part of a service) that makes it easy to extract. There is a tag called <code>aws:createdBy</code> that can be activated in the Billing Console via the management account, <a href=https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/aws-tags.html target=_blank>after which AWS will apply it to a subset of resources</a>.</p><p>The only issue with this tag is that it is only available in the Billing console and reports - it does not appear alongside other tags for your resources. There are some <a href=https://github.com/wolfeidau/aws-billing-store/ target=_blank>great projects</a> out there that look to make this report information more easily queryable - but they still didn&rsquo;t feel like the right fit for us, as many of the projects pushed the tag information into a separate repository, with tag information about newly created resources susceptible to a delay.</p><p>Finally, I found a <a href=https://aws.amazon.com/blogs/mt/auto-tag-aws-resources/ target=_blank>post from the AWS Cloud Operations & Migrations blog</a> from back in November 2020 that was exactly what I was looking for. It was a solution that used CloudWatch events and a Lambda function to read incoming <code>RunInstances</code> CloudTrail events and use the information from within the event to tag the newly created resource. It even had sample Python code for the Lambda function! There were only one problem with this example that prevented it from being a slam dunk - it was focused on only one account and one region. To make this solution useful in our environment, we would have to extend it to work across all of the accounts in a certain OU, and across all regions.</p><h2 class="relative group">The Auto Tagging Solution, Explained<div id=the-auto-tagging-solution-explained class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-auto-tagging-solution-explained aria-label=Anchor>#</a></span></h2><p>In case you don&rsquo;t want to click through to the AWS blog post itself, I&rsquo;ll briefly explain the solution. When a principal starts an EC2 instance in AWS, a <code>RunInstances</code> event is generated and logged by CloudTrail. These events contain a variety of information, including the time of the event, the principal that triggered it, the account that the instance was created in, and the region that the instance was created in. All of this information is extremely useful to capture.</p><p><a href=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/cloudtrailevent.png><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="An example of a CloudTrail event for RunInstances" width=803 height=709 src=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/cloudtrailevent_hu_5bec1dbd18632cfa.png srcset="/posts/automatically-tagging-resources-in-aws-with-owner-information/images/cloudtrailevent_hu_5bec1dbd18632cfa.png 800w, /posts/automatically-tagging-resources-in-aws-with-owner-information/images/cloudtrailevent.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/cloudtrailevent.png></figure></a></p><p>A service called AWS EventBridge (formerly CloudWatch Events) allows for rules to be created that can monitor CloudTrail for specific events, and then perform some action based on the event. The auto tagging solution includes a rule that monitors for the <code>RunInstances</code> events, and then sends the information from a captured event to an AWS Lambda function. This Lambda function reads the information in the event (mostly the instance ID and principal information), and then uses that information to apply a tag to the instance with the information about the principal.</p><p>The chief limitation of this solution, as presented in the blog post, is that CloudTrail in a given region will only capture the <code>RunInstances</code> events that happen in that region. Additionally, a Lambda function would only be able to apply tags to instances in the same account as the function itself.</p><h2 class="relative group">Modifying the AWS Example<div id=modifying-the-aws-example class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#modifying-the-aws-example aria-label=Anchor>#</a></span></h2><p>The first problem - that the example solution only covered a single region - can be solved easily enough. Whereas the example used a single Event Rule, we would have to end up deploying the same rule in every region (of every account) that we planned on supporting as part of this solution. This requirement could be met by running a CloudFormation StackSet that created the rule in each region that each account uses.</p><p>The second problem - that the example focused on just one account - was a little trickier to think about. Event rules can send events to Lambda functions only in the same account as the rule. We needed a way to send events from other accounts in the organization to our account, and then another mechanism to apply the tags back onto the correct instances in those various accounts.</p><p>We ended up creating an event bus in our Security account, solely for the purpose of receiving these resource creation events from other accounts. Each event rule would send their events to this event bus instead of directly to a Lambda function. The bus, in turn, would be the doorway to our Lambda function, as it would live in the same account as the function itself.</p><p>Next, we created two IAM roles in each managed account. One role has the <code>PutEvent</code> permission, used by the Event Rule to send events to the event bus in the Security account. The second role has the <code>ec2:CreateTags</code> and <code>ec2:DescribeVolumes</code> permission, and its trust policy allows our Lambda&rsquo;s execution role to assume it. CloudFormation is again used to help deploy these to all accounts in scope. It&rsquo;s best to deploy the CloudFormation for creating the IAM roles first, as you can then reference the <code>PutEvent</code> role in your CloudFormation for deploying the Event Rule itself.</p><p>Lastly, we added permissions to our Lambda execution role; namely, a policy to assume the auto tagging role in any account:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;sts:AssumeRole&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:iam::*:role/auto-tag-role&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;ResourceAutoTaggerAssumeRole&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>Once the Lambda function was invoked, it would mostly use the code provided by the AWS blog post example. However, we modified a couple of key areas. We used the source code from the <a href=https://github.com/aws-samples/resource-auto-tagger target=_blank>blog post example GitHub repo</a> and set about modifying <code>resource-auto-tager.py</code>. In the <code>lambda_handler</code> function, we added some code to pull the account ID and region from the CloudTrail event:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Parse the passed CloudTrail event and extract pertinent EC2 launch fields</span>
</span></span><span class=line><span class=cl>    <span class=n>event_fields</span> <span class=o>=</span> <span class=n>cloudtrail_event_parser</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>accountId</span> <span class=o>=</span> <span class=n>event_fields</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;account_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>region</span> <span class=o>=</span> <span class=n>event_fields</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;region&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Instance created in Account: </span><span class=si>{</span><span class=n>accountId</span><span class=si>}</span><span class=s2> in region: </span><span class=si>{</span><span class=n>region</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div></div><p>We then pass <code>accountID</code> and <code>region</code> to the <code>set_ec2_instance_attached_vols_tags</code> function, alongside the <code>ec2_instance_id</code> and <code>resource_tags</code> as seen in the example. Once inside that function, we use the <code>account_id</code> to assume the IAM role that we deployed to every account for the purposes of applying the tags, and build an EC2 client object on the back of that assumed role session and the region.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>set_ec2_instance_attached_vols_tags</span><span class=p>(</span><span class=n>ec2_instance_id</span><span class=p>,</span> <span class=n>resource_tags</span><span class=p>,</span> <span class=n>account_id</span><span class=p>,</span> <span class=n>region</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># First assume the role created in the account that has permission to tag the resources</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Attempting to assume role in target account</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>assumed_role_response</span> <span class=o>=</span> <span class=n>sts_client</span><span class=o>.</span><span class=n>assume_role</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>RoleArn</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;arn:aws:iam::</span><span class=si>{</span><span class=n>account_id</span><span class=si>}</span><span class=s2>:role/auto-tag-role&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>RoleSessionName</span><span class=o>=</span><span class=s2>&#34;auto-tag-session&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>assumed_role_session</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>Session</span><span class=p>(</span><span class=n>aws_access_key_id</span><span class=o>=</span><span class=n>assumed_role_response</span><span class=p>[</span><span class=s1>&#39;Credentials&#39;</span><span class=p>][</span><span class=s1>&#39;AccessKeyId&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=n>aws_secret_access_key</span><span class=o>=</span><span class=n>assumed_role_response</span><span class=p>[</span><span class=s1>&#39;Credentials&#39;</span><span class=p>][</span><span class=s1>&#39;SecretAccessKey&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=n>aws_session_token</span><span class=o>=</span><span class=n>assumed_role_response</span><span class=p>[</span><span class=s1>&#39;Credentials&#39;</span><span class=p>][</span><span class=s1>&#39;SessionToken&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>assumed_role_ec2_client</span> <span class=o>=</span> <span class=n>assumed_role_session</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s2>&#34;ec2&#34;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=n>region</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Assumed role in target account successfully</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div></div><p>Because we have used CloudFormation to deploy the same role to every account, it will be waiting for us, no matter which <code>account_id</code> gets passed in here and used as part of the ARN. And because the Lambda&rsquo;s execution role is trusted by each of those roles in the various accounts, it will be able to assume it without issue. The rest of the code is almost entirely unmodified.</p><p>Stepping back and looking at the complete solution, it can be summarized by this diagram:</p><p><a href=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/autotagdiagram.png><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="A simple diagram showing the flow of events through the solution" width=1700 height=916 src=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/autotagdiagram_hu_b141224184e31865.png srcset="/posts/automatically-tagging-resources-in-aws-with-owner-information/images/autotagdiagram_hu_b141224184e31865.png 800w, /posts/automatically-tagging-resources-in-aws-with-owner-information/images/autotagdiagram_hu_eb88609f7c7ef274.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/autotagdiagram.png></figure></a></p><h2 class="relative group">Applying the Service Control Policy<div id=applying-the-service-control-policy class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#applying-the-service-control-policy aria-label=Anchor>#</a></span></h2><p>Once the tags are created, we want to prevent someone from removing them, either accidentally or in an attempt to cover their tracks. This can be handled by a pretty straightforward service control policy (SCP) that just blocks the tags that you have decided to apply. In this case, we denied the <code>ec2:DeleteTags</code> action for the <code>owner</code> and <code>dateCreated</code> tags, and attached it to the OU of accounts where we would deploy the solution.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_iam_policy_document&#34;</span> <span class=s2>&#34;auto_tag_delete_policy&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statement</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>effect</span>          <span class=o>=</span> <span class=s2>&#34;Deny&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nx>actions</span>         <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ec2:DeleteTags&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>resources</span>       <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>condition</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>test</span>        <span class=o>=</span> <span class=s2>&#34;ForAnyValue:StringEquals&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nx>variable</span>    <span class=o>=</span> <span class=s2>&#34;aws:TagKeys&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>values</span>      <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;dateCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;owner&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_organizations_policy&#34;</span> <span class=s2>&#34;prevent_auto_tag_delete&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>                <span class=o>=</span> <span class=s2>&#34;prevent-auto-tag-modification&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>description</span>         <span class=o>=</span> <span class=s2>&#34;Prevents removal of tags automatically applied by InfoSec&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>content</span>             <span class=o>=</span> <span class=nb>data</span><span class=p>.</span><span class=nx>aws_iam_policy_document</span><span class=p>.</span><span class=nx>auto_tag_delete_policy</span><span class=p>.</span><span class=nx>json</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_organizations_policy_attachment&#34;</span> <span class=s2>&#34;managed_ou&#34;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>policy_id</span>           <span class=o>=</span> <span class=nx>aws_organizations_policy</span><span class=p>.</span><span class=nx>prevent_auto_tag_delete</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>    <span class=nx>target_id</span>           <span class=o>=</span> <span class=nb>var</span><span class=p>.</span><span class=nx>managed_ou</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h2 class="relative group">Results and Additional Considerations<div id=results-and-additional-considerations class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#results-and-additional-considerations aria-label=Anchor>#</a></span></h2><p>Once everything was in place and enabled, tags began being automatically applied to our EC2 instances as they were created.</p><p><a href=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/tagscreated.png><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=auto alt="An example of the dateCreated and owner tags applied to an instance" width=724 height=235 src=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/tagscreated.png srcset="/posts/automatically-tagging-resources-in-aws-with-owner-information/images/tagscreated.png 800w, /posts/automatically-tagging-resources-in-aws-with-owner-information/images/tagscreated.png 1280w" sizes="(min-width: 768px) 50vw, 65vw" data-zoom-src=/posts/automatically-tagging-resources-in-aws-with-owner-information/images/tagscreated.png></figure></a></p><p>Through an extensive testing and monitoring process, I learned a few things and wanted to point out some additional things to keep in mind:</p><ul><li>Regions further away from where your event bus and Lambda function are will take a few seconds longer to have tags applied to them, due to round trip times. Make sure you adjust the default Lambda timeout threshold to something like 3 minutes just to make sure you&rsquo;re not losing any tagging due to a slightly delayed event.</li><li>While the SCP prevents someone from deleting the tags, it does nothing to stop them from modifying them. Overwriting tags falls under the <code>ec2:CreateTags</code> permission, which is what is used to apply these tags in the first place. Therefore, it would be trivial for someone to edit the <code>owner</code> tag after the fact to cover their own tracks. It is recommended you combine this solution with a tool or service that takes routine inventory snapshots of your instance fleet, such as <a href=https://www.cloudquery.io/ target=_blank>CloudQuery</a> so that you can track changes to tags over time.</li><li>We actually ended up adding an additional tag called &ldquo;WhatIsThis&rdquo; with a value that was a URL that pointed to a page on our internal security wiki explaining what auto-tagging was and why it was being applied to resources. While we sent out communications to the account owners and administrators prior to rolling the solution out, there was still going to be some users who would be confused why certain tags were being applied to instances that they had created. Depending on your organization&rsquo;s culture, it may be a good idea to include something like this to prevent a torrent of emails or Slack messages inquiring about the tags.</li><li>If your organization has teams already using infrastructure as code to manage their resources, they may need to add some configuration to ignore these tags as sources of drift. For example, Terraform has an <code>ignore_tags</code> <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs#ignore_tags target=_blank>configuration block for the AWS provider</a> that will allow the automatically applied tags to be ignored.</li><li>For accounts that routinely spin up large numbers of EC2 instances at the same time, make sure you review the current rate limits and quotas for the <code>DescribeInstances</code>, <code>CreateTags</code>, and <code>DescribeVolumes</code> API calls, as you can quickly hit the rate limit when large numbers of resources are created concurrently.</li><li>Although this solution works great for newly created EC2 instances, it does nothing for instances that already exist. For those use cases, you&rsquo;re probably better off using something like <a href=https://github.com/wolfeidau/aws-billing-store/ target=_blank>Mark Wolfe&rsquo;s excellent project</a> that automates pushing Cost and Usage report information into an Athena table.</li></ul><p>It is my hope that this post helps others fill in this gap in their own AWS security and compliance posture. I&rsquo;m always happy to discuss this solution, especially ways it can be improved, if you wish to <a href=../../contact>reach out</a>.</p></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/2023-07-31/index.md data-oid-likes=likes_posts/2023-07-31/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/building-on-gcp/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Building on GCP
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-02-27T00:00:00+00:00>27 February 2023</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/googles-professional-cloud-security-engineer-certification/><span class=leading-6>Google's Professional Cloud Security Engineer Certification&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-08-18T00:00:00+00:00>18 August 2023</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 overflow-x-auto py-2"><ul class="flex list-none flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 me-4"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href title></a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
John Misczak</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://misczak.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>